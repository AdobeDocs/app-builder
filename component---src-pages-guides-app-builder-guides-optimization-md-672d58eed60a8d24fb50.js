"use strict";(self.webpackChunkadobe_developer_app_builder=self.webpackChunkadobe_developer_app_builder||[]).push([[408],{37946:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return l},default:function(){return d}});var o=a(58168),n=a(80045),i=(a(88763),a(15680)),r=a(83407);const s=["components"],l={},m={_frontmatter:l},p=r.A;function d(e){let{components:t}=e,a=(0,n.A)(e,s);return(0,i.mdx)(p,(0,o.A)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"optimizing-app-builder-apps"},"Optimizing App Builder Apps"),(0,i.mdx)("p",null,"There are many ways to optimize a web app: for security, performance, or operational cost, to name a few. Here are some techniques to help you get the most from your App Builder applications."),(0,i.mdx)("h2",{id:"caching-http-responses"},"Caching HTTP responses"),(0,i.mdx)("p",null,"This method works extremely well if your action returns some results based on repeated user inputs as query params, for example details about a webshop item or visualization of static data. In such cases your back-end action is invoked once only: subsequent requests receive results directly from the cache by the expiry time. Serving results from cache is not only faster, but saves the cost of action invocations."),(0,i.mdx)("p",null,"To configure the cache, use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"Cache-Control")," directive. Below is an example of an action that sets the cache with a TTL of 30 minutes. In the response object you will find an entry with ",(0,i.mdx)("inlineCode",{parentName:"p"},"X-GW-Cache: HIT")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"X-GW-Cache: MISS"),", depending on whether the answer was returned from cache or not."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-javascript"},"async function main (params) {\n  return {\n      headers: {\n        'Cache-Control': 'max-age=1800'\n      },\n      statusCode: 200,\n      body: { message: 'I am cached for 30 minutes.' }\n  }\n}\n")),(0,i.mdx)("p",null,"When you test this functionality for web action using Postman or a web browser with Developer tools opened, be sure that ",(0,i.mdx)("inlineCode",{parentName:"p"},"Cache-Control")," is not set automatically for all the requests."),(0,i.mdx)("h2",{id:"returning-large-response-payloads"},"Returning large response payloads"),(0,i.mdx)("p",null,"An Adobe I/O Runtime action can return a ",(0,i.mdx)("a",{parentName:"p",href:"../runtime_guides/system_settings.md"},"response payload of 1MB")," - enough for most use cases. If your action will return a larger payload, we provide a scalable solution with ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/adobe/aio-lib-files"},"App Builder Files SDK"),". It allows you to ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/adobe/aio-lib-files/blob/master/doc/api.md#Files+write"},"persist a binary file to the blob storage"),", obtain ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/adobe/aio-lib-files/blob/master/doc/api.md#Files+generatePresignURL"},"a temporary downloadable URL")," and return an ",(0,i.mdx)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/302"},"HTTP Redirect response")," to the file with this URL. Here is a demonstration:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-javascript"},"const fileLocation = '/private-dir/large-image.png'\nconst files = await Files.init()\nawait files.write(fileLocation, fileContent)\n\n// Generate a presigned URL of the file that is valid for 60 seconds only\nconst presignUrl = await files.generatePresignURL(fileLocation, { expiryInSeconds: 60 })\n\nreturn {\n  headers: { location: presignUrl }, \n  statusCode: 302\n}\n")),(0,i.mdx)("h2",{id:"implementing-move-operations-for-the-app-builder-files-sdk"},"Implementing move operations for the App Builder Files SDK"),(0,i.mdx)("p",null,"When using using ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/adobe/aio-lib-files"},"App Builder Files SDK")," to handle large files within a Runtime action, you may need to move those files to another location in the underlying cloud storage, for example to archive them when computing is over."),(0,i.mdx)("p",null,"We have not exposed a move operation in our abstraction, because:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Some cloud storage APIs do not offer an atomic move operation, forcing a tradeoff between abstraction and consistency. Users might expect files operations on single files and folders to be atomic when they're not."),(0,i.mdx)("li",{parentName:"ul"},"It's easy to implement and test the abstraction at application level.")),(0,i.mdx)("p",null,"Here is our recommendation to implement the move operation at application level using ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/adobe/aio-lib-files"},"App Builder Files SDK")," primitives:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-javascript"},"/**\n * Note: this operation is not atomic.\n * Moves files from one location to another in the remote storage. \n *  \n * @param {Files} files the files instance\n * @param {string} src source file/folder\n * @param {string} dest destination file/folder\n * @param {object} [options={}] move options\n * @param {Function} [options.progressCallback] a function that will be called every\n *   time the operation completes on a single file, the srcPath and destPath to the moved\n *   file are passed as argument to the callback `progressCallback(srcPath, destPath)`\n */\nasync function move (files, src, dest, options = {}) {\n  try {\n    const res = await files.copy(src, dest, { progressCallback: options.progressCallback })\n    await files.delete(src)\n    return res\n  } catch (e) {\n    e.message = `Move operation failed, reason: ${e.message}`\n    throw e\n  }\n}\n")),(0,i.mdx)("p",null,"Here are some usage examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-javascript"},"const files = await Files.init()\nawait move(files, 'my/remote/src/folder/', 'my/remote/dest/')\nawait move(files, 'my/remote/src/folder/file.txt', 'my/remote/dest/file2.md') // will move and rename the file\nawait move(files, 'my/remote/src/folder/file.txt', 'my/remote/dest/') // will move file.txt to dest folder\nawait move(files, 'my/remote/src/folder/', 'my/remote/dest/') // move folder to the dest folder\nawait move(files, 'my/remote/folder/', 'my/remote/dest') // will rename folder to dest\n")),(0,i.mdx)("h2",{id:"next-step"},"Next step"),(0,i.mdx)("p",null,"Return to ",(0,i.mdx)("a",{parentName:"p",href:"../index.md"},"Guides Index"),"."))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-app-builder-guides-optimization-md-672d58eed60a8d24fb50.js.map