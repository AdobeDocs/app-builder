"use strict";(self.webpackChunkadobe_developer_app_builder=self.webpackChunkadobe_developer_app_builder||[]).push([[6989],{2077:function(e,o,t){t.r(o),t.d(o,{_frontmatter:function(){return p},default:function(){return u}});var n=t(87462),a=t(63366),i=(t(15007),t(64983)),s=t(91515),r=["components"],p={},d={_frontmatter:p},l=s.Z;function u(e){var o=e.components,t=(0,a.Z)(e,r);return(0,i.mdx)(l,(0,n.Z)({},d,t,{components:o,mdxType:"MDXLayout"}),(0,i.mdx)("h1",null,"Lesson 3: Develop custom worker calling Photoshop APIs"),(0,i.mdx)("p",null,"Now you got the development environment set up locally and can run a basic worker, let's enhance it to do something more complex."),(0,i.mdx)("p",null,(0,i.mdx)("a",{parentName:"p",href:"/app-builder/photoshop/api/"},"Adobe Photoshop APIs")," enable you to build plugins and integrations that harness the power of the worldâ€™s best image editing and graphic design software to transform creative workflows for users everywhere. In this codelab, you leverage the Photoshop APIs to generate custom renditions in AEM Assets."),(0,i.mdx)("p",null,"You will need the ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/adobe/aio-lib-files"},"App Builder Files SDK")," to store images, the ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/adobe/aio-lib-photoshop-api"},"Photoshop API SDK")," to call Photoshop APIs, and UUID to generate unique folder names for renditions of different images. Add them as dependencies in your ",(0,i.mdx)("inlineCode",{parentName:"p"},"package.json")," file."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'"dependencies": {\n    "@adobe/aio-lib-photoshop-api": "0.0.4-beta.4",\n    "@adobe/aio-sdk": "^2.3.0",\n    "@adobe/asset-compute-sdk": "^2.2.1",\n    "uuid": "^8.0.0"\n}\n')),(0,i.mdx)("p",null,(0,i.mdx)("em",{parentName:"p"},"Note: ",(0,i.mdx)("a",{parentName:"em",href:"https://github.com/adobe/aio-lib-photoshop-api"},"Photoshop API SDK")," is currently in beta release and its version is constantly changing. Please visit ",(0,i.mdx)("a",{parentName:"em",href:"https://github.com/adobe/aio-lib-photoshop-api"},"its GitHub repo")," to find out the latest version.")),(0,i.mdx)("p",null,"Make sure you run ",(0,i.mdx)("inlineCode",{parentName:"p"},"npm install")," after updating the ",(0,i.mdx)("inlineCode",{parentName:"p"},"package.json")," file, so that all the npm modules are installed."),(0,i.mdx)("p",null,"Then update your action code in ",(0,i.mdx)("inlineCode",{parentName:"p"},"actions/<worker-name>/index.js")," to use the Photoshop API SDK. In this example, it calls the ",(0,i.mdx)("a",{parentName:"p",href:"https://adobedocs.github.io/photoshop-api-docs-pre-release/#api-Sensei-cutout"},"cutout service")," to remove the background of an image."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-javascript"},"const { worker, SourceCorruptError } = require('@adobe/asset-compute-sdk');\nconst fs = require('fs').promises;\nconst { Files } = require('@adobe/aio-sdk');\nconst Photoshop = require('@adobe/aio-lib-photoshop-api');\nconst { v4: uuid4 } = require('uuid');\n\nexports.main = worker(async (source, rendition, params) => {\n    const files = await Files.init();\n\n    // obtain access token and org ID\n    const accessToken = params.auth && params.auth.accessToken;\n    const orgId = params.auth && params.auth.orgId;\n\n    // init Photoshop SDK client\n    const psClient = await Photoshop.init(orgId, params.apiKey, accessToken, files);\n\n    // create a new directory in aio-lib-files with unique name\n    const imageId = uuid4();\n    const aioSourcePath = `${imageId}/source.png`;\n    const aioRenditionPath = `${imageId}/rendition.png`;\n\n    await files.copy(source.path, aioSourcePath, { localSrc: true });\n\n    // call Photoshop API to do cutout processing, and poll status until it's successful\n    const result = await psClient.createCutout(aioSourcePath, aioRenditionPath);\n    await result.pollUntilDone(1000);\n\n    // download the rendition to local AEM Assets destination\n    await files.copy(aioRenditionPath, rendition.path, { localDest: true });\n\n    // clean up files processing folder in aio-lib-files\n    await files.delete(`${imageId}/`);\n});\n")),(0,i.mdx)("p",null,"Because the SDK requires ",(0,i.mdx)("inlineCode",{parentName:"p"},"apiKey")," to be passed in the input params, update your ",(0,i.mdx)("inlineCode",{parentName:"p"},"ext.config.yaml")," in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"src/dx-asset-compute-worker-1/")," folder to include it."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-yaml"},"operations:\n  workerProcess:\n    - type: action\n      impl: dx-asset-compute-worker-1/worker\nhooks:\n  post-app-run: adobe-asset-compute devtool\n  test: adobe-asset-compute test-worker\nactions: actions\nruntimeManifest:\n  packages:\n    dx-asset-compute-worker-1:\n      license: Apache-2.0\n      actions:\n        worker:\n          function: actions/worker/index.js\n          web: 'yes'\n          runtime: 'nodejs:14'\n          limits:\n            concurrency: 10\n          inputs:\n              apiKey: $SERVICE_API_KEY\n          annotations:\n            require-adobe-auth: true\n")),(0,i.mdx)("p",null,"Your worker should now be set. "),(0,i.mdx)("p",null,"Run the ",(0,i.mdx)("inlineCode",{parentName:"p"},"aio app deploy")," command to deploy your action to test in the development tool UI."),(0,i.mdx)("p",null,"Then execute the command ",(0,i.mdx)("inlineCode",{parentName:"p"},"aio app run")," to test it. In the development tool UI, select an existing or upload a new test image, define the rendition request and click the Run button. You will see the rendition result with a removed background."),(0,i.mdx)("p",null,"There are various options of other photo magics that you can use to enhance your custom worker, such as ",(0,i.mdx)("a",{parentName:"p",href:"https://adobe.io/apis/creativecloud/photo-imaging-api/api-demo.html?ref=autotone"},"Auto Tone")," and ",(0,i.mdx)("a",{parentName:"p",href:"https://adobe.io/apis/creativecloud/photo-imaging-api/api-demo.html?ref=psactions"},"Photoshop actions"),". Be creative!"))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-resources-asset-compute-worker-ps-api-lesson-3-md-fbaa5abd1ac2942acb57.js.map