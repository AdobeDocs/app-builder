{"version":3,"sources":["webpack://project-firefly/./src/pages/resources/asset-compute-worker-ps-api/lesson3.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"mRAQaA,EAAe,GACtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGX,IAFFC,EAEC,EAFDA,WACGC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,eACE,GAAM,yDADR,2DAGA,wJACA,mBAAG,cAAGC,WAAW,IACb,KAAQ,mCADT,wBAAH,2RAGA,wCAAyB,cAAGA,WAAW,IACnC,KAAQ,0CADa,yBAAzB,0BAE4D,cAAGA,WAAW,IACtE,KAAQ,kDADgD,qBAF5D,2IAIyK,uBAAYA,WAAW,KAAvB,gBAJzK,WAKA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBADZ,mLASL,mBAAG,eAAIA,WAAW,KAAf,UAA6B,cAAGA,WAAW,KACxC,KAAQ,kDADkB,qBAA7B,uFAEoH,cAAGA,WAAW,KAC/H,KAAQ,kDADyG,mBAFpH,sCAKH,wCAAyB,uBAAYA,WAAW,KAAvB,eAAzB,wBAAwG,uBAAYA,WAAW,KAAvB,gBAAxG,sDACA,sDAAuC,uBAAYA,WAAW,KAAvB,kCAAvC,iEAAkL,cAAGA,WAAW,IAC5L,KAAQ,iFADsK,kBAAlL,2CAGA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,82CAoCL,+CAAgC,uBAAYA,WAAW,KAAvB,UAAhC,mDAAqI,uBAAYA,WAAW,KAAvB,mBAArI,YAA4M,uBAAYA,WAAW,KAAvB,kCAA5M,2BACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBADZ,8lBA0BL,sDACA,8BAAe,uBAAYA,WAAW,KAAvB,kBAAf,uEACA,+CAAgC,uBAAYA,WAAW,KAAvB,eAAhC,gNACA,8HAA+G,cAAGA,WAAW,IACzH,KAAQ,oFADmG,aAA/G,SAE+B,cAAGA,WAAW,IACzC,KAAQ,qFADmB,qBAF/B,mBASJJ,EAAWK,gBAAiB","file":"component---src-pages-resources-asset-compute-worker-ps-api-lesson-3-md-f684881b1a7d34d358cd.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/project-firefly/project-firefly/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"lesson-3-develop-custom-worker-calling-photoshop-apis\"\n    }}>{`Lesson 3: Develop custom worker calling Photoshop APIs`}</h1>\n    <p>{`Now you got the development environment set up locally and can run a basic worker, let's enhance it to do something more complex.`}</p>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"/project-firefly/photoshop/api/\"\n      }}>{`Adobe Photoshop APIs`}</a>{` enable you to build plugins and integrations that harness the power of the worldâ€™s best image editing and graphic design software to transform creative workflows for users everywhere. In this codelab, you leverage the Photoshop APIs to generate custom renditions in AEM Assets.`}</p>\n    <p>{`You will need the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/adobe/aio-lib-files\"\n      }}>{`App Builder Files SDK`}</a>{` to store images, the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/adobe/aio-lib-photoshop-api\"\n      }}>{`Photoshop API SDK`}</a>{` to call Photoshop APIs, and UUID to generate unique folder names for renditions of different images. Add them as dependencies in your `}<inlineCode parentName=\"p\">{`package.json`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`\"dependencies\": {\n    \"@adobe/aio-lib-photoshop-api\": \"0.0.4-beta.4\",\n    \"@adobe/aio-sdk\": \"^2.3.0\",\n    \"@adobe/asset-compute-sdk\": \"^2.2.1\",\n    \"uuid\": \"^8.0.0\"\n}\n`}</code></pre>\n    <p><em parentName=\"p\">{`Note: `}<a parentName=\"em\" {...{\n          \"href\": \"https://github.com/adobe/aio-lib-photoshop-api\"\n        }}>{`Photoshop API SDK`}</a>{` is currently in beta release and its version is constantly changing. Please visit `}<a parentName=\"em\" {...{\n          \"href\": \"https://github.com/adobe/aio-lib-photoshop-api\"\n        }}>{`its GitHub repo`}</a>{` to find out the latest version.`}</em></p>\n    <p>{`Make sure you run `}<inlineCode parentName=\"p\">{`npm install`}</inlineCode>{` after updating the `}<inlineCode parentName=\"p\">{`package.json`}</inlineCode>{` file, so that all the npm modules are installed.`}</p>\n    <p>{`Then update your action code in `}<inlineCode parentName=\"p\">{`actions/<worker-name>/index.js`}</inlineCode>{` to use the Photoshop API SDK. In this example, it calls the `}<a parentName=\"p\" {...{\n        \"href\": \"https://adobedocs.github.io/photoshop-api-docs-pre-release/#api-Sensei-cutout\"\n      }}>{`cutout service`}</a>{` to remove the background of an image.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const { worker, SourceCorruptError } = require('@adobe/asset-compute-sdk');\nconst fs = require('fs').promises;\nconst { Files } = require('@adobe/aio-sdk');\nconst Photoshop = require('@adobe/aio-lib-photoshop-api');\nconst { v4: uuid4 } = require('uuid');\n\nexports.main = worker(async (source, rendition, params) => {\n    const files = await Files.init();\n\n    // obtain access token and org ID\n    const accessToken = params.auth && params.auth.accessToken;\n    const orgId = params.auth && params.auth.orgId;\n\n    // init Photoshop SDK client\n    const psClient = await Photoshop.init(orgId, params.apiKey, accessToken, files);\n\n    // create a new directory in aio-lib-files with unique name\n    const imageId = uuid4();\n    const aioSourcePath = \\`\\${imageId}/source.png\\`;\n    const aioRenditionPath = \\`\\${imageId}/rendition.png\\`;\n\n    await files.copy(source.path, aioSourcePath, { localSrc: true });\n\n    // call Photoshop API to do cutout processing, and poll status until it's successful\n    const result = await psClient.createCutout(aioSourcePath, aioRenditionPath);\n    await result.pollUntilDone(1000);\n\n    // download the rendition to local AEM Assets destination\n    await files.copy(aioRenditionPath, rendition.path, { localDest: true });\n\n    // clean up files processing folder in aio-lib-files\n    await files.delete(\\`\\${imageId}/\\`);\n});\n`}</code></pre>\n    <p>{`Because the SDK requires `}<inlineCode parentName=\"p\">{`apiKey`}</inlineCode>{` to be passed in the input params, update your `}<inlineCode parentName=\"p\">{`ext.config.yaml`}</inlineCode>{` in the `}<inlineCode parentName=\"p\">{`src/dx-asset-compute-worker-1/`}</inlineCode>{` folder to include it.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`operations:\n  workerProcess:\n    - type: action\n      impl: dx-asset-compute-worker-1/worker\nhooks:\n  post-app-run: adobe-asset-compute devtool\n  test: adobe-asset-compute test-worker\nactions: actions\nruntimeManifest:\n  packages:\n    dx-asset-compute-worker-1:\n      license: Apache-2.0\n      actions:\n        worker:\n          function: actions/worker/index.js\n          web: 'yes'\n          runtime: 'nodejs:14'\n          limits:\n            concurrency: 10\n          inputs:\n              apiKey: $SERVICE_API_KEY\n          annotations:\n            require-adobe-auth: true\n`}</code></pre>\n    <p>{`Your worker should now be set. `}</p>\n    <p>{`Run the `}<inlineCode parentName=\"p\">{`aio app deploy`}</inlineCode>{` command to deploy your action to test in the development tool UI.`}</p>\n    <p>{`Then execute the command `}<inlineCode parentName=\"p\">{`aio app run`}</inlineCode>{` to test it. In the development tool UI, select an existing or upload a new test image, define the rendition request and click the Run button. You will see the rendition result with a removed background.`}</p>\n    <p>{`There are various options of other photo magics that you can use to enhance your custom worker, such as `}<a parentName=\"p\" {...{\n        \"href\": \"https://adobe.io/apis/creativecloud/photo-imaging-api/api-demo.html?ref=autotone\"\n      }}>{`Auto Tone`}</a>{` and `}<a parentName=\"p\" {...{\n        \"href\": \"https://adobe.io/apis/creativecloud/photo-imaging-api/api-demo.html?ref=psactions\"\n      }}>{`Photoshop actions`}</a>{`. Be creative!`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}