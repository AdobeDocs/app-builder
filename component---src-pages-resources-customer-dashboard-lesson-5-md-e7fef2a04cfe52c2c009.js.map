{"version":3,"sources":["webpack://project-firefly/./src/pages/resources/customer-dashboard/lesson5.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-resources-customer-dashboard-lesson-5-md-e7fef2a04cfe52c2c009.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/project-firefly/project-firefly/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"lesson-5-add-personalized-promotion-emails-triggering\"\n    }}>{`Lesson 5: Add Personalized Promotion Emails Triggering`}</h1>\n    <p><em parentName=\"p\">{`Note: This is an advanced part of the codelab. You are recommended to go through it, but feel free to skip and jump to the `}<a parentName=\"em\" {...{\n          \"href\": \"welldone.md\"\n        }}>{`Recap`}</a>{`.`}</em></p>\n    <p>{`Now that your app displays a list of customer profiles, let's try adding some user interaction to it. Imagine as a marketer looking at different customer profiles with more extensive data (past orders, date of birth, gender), you may want to send promotional discount codes to some specific customers to motivate them to buy your products. Therefore, we will add a \"Send promo code\" button.`}</p>\n    <p>{`First of all, you need a new action for generating promo code. Here we use the `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.npmjs.com/package/uuid\"\n      }}>{`uuid`}</a>{` npm package to generate it, and `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.npmjs.com/package/bwip-js\"\n      }}>{`bwip-js`}</a>{` to render a visual barcode. Simply add them as a dependency in `}<inlineCode parentName=\"p\">{`package.json`}</inlineCode>{`, and run `}<inlineCode parentName=\"p\">{`npm install`}</inlineCode>{`. To add the new action, run the following `}<inlineCode parentName=\"p\">{`aio`}</inlineCode>{` command, and specify the inputs according to the screenshot below.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`aio app add action\n`}</code></pre>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"50%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/cb523/action-code.webp 320w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/797b9/action-code.webp 640w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/4b075/action-code.webp 1280w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/f3ff0/action-code.webp 1920w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/a662b/action-code.webp 2560w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/10398/action-code.webp 2666w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/72799/action-code.png 320w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/6af66/action-code.png 640w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/21b4d/action-code.png 1280w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/29114/action-code.png 1920w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/c2d13/action-code.png 2560w\", \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/963fa/action-code.png 2666w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/project-firefly/static/a35f66c094ecc59289abd0d4875fff87/21b4d/action-code.png\",\n            \"alt\": \"action-code\",\n            \"title\": \"action-code\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <p>{`Upon a successful command execution, the `}<inlineCode parentName=\"p\">{`generate-code`}</inlineCode>{` action is added to the ext.config.yaml file, and its source code is at `}<inlineCode parentName=\"p\">{`src/dx-excshell-1/actions/generate-code/index.js`}</inlineCode>{`. As we don't need an authentication on this action, we will remove `}<inlineCode parentName=\"p\">{`require-adobe-auth: true`}</inlineCode>{` from its definition in manifest file, as well as remove the relevant authorization checks in the code. In addition, we add the code for generating UUID and return it in the response body.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`/**\n * This action generates a barcode of a random UUID as personalized promo code\n */\n\nconst { Core } = require('@adobe/aio-sdk')\nconst { v4: uuid4 } = require('uuid')\nconst bwipjs = require('bwip-js')\nconst { errorResponse } = require('../utils')\n\n// main function that will be executed by Adobe I/O Runtime\nasync function main (params) {\n  // create a Logger\n  const logger = Core.Logger('main', { level: params.LOG_LEVEL || 'info' })\n\n  try {\n    // 'info' is the default level if not set\n    logger.info('Calling the main action')\n\n    // generate UUID code\n    const promoCode = uuid4()\n    const buffer = await bwipjs.toBuffer({\n      bcid: 'code128',\n      text: promoCode,\n      scale: 2,\n      includetext: true,\n      backgroundcolor: 'ffffff'\n    })\n    const response = {\n      headers: { 'Content-Type': 'image/png' },\n      statusCode: 200,\n      body: buffer.toString('base64')\n    }\n\n    // log the response status code\n    logger.info(\\`\\${response.statusCode}: successful request\\`)\n    return response\n  } catch (error) {\n    // log any server errors\n    logger.error(error)\n    // return with 500\n    return errorResponse(500, 'server error', logger)\n  }\n}\n\nexports.main = main\n`}</code></pre>\n    <p>{`Verify that the new action is working by running the app locally with `}<inlineCode parentName=\"p\">{`aio app run`}</inlineCode>{`, and check the response of `}<inlineCode parentName=\"p\">{`https://<your-namespace>.adobeioruntime.net/api/v1/dx-excshell-1/generate-code`}</inlineCode>{` on the browser. You can find your own URL from the terminal output.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"35.625%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/cb523/generate-code.webp 320w\", \"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/797b9/generate-code.webp 640w\", \"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/4b075/generate-code.webp 1280w\", \"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/f3ff0/generate-code.webp 1920w\", \"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/ada64/generate-code.webp 1998w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/72799/generate-code.png 320w\", \"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/6af66/generate-code.png 640w\", \"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/21b4d/generate-code.png 1280w\", \"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/29114/generate-code.png 1920w\", \"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/1a867/generate-code.png 1998w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/project-firefly/static/970fa4bfb8d0358da97f32f45ab3ac84/21b4d/generate-code.png\",\n            \"alt\": \"generate-code\",\n            \"title\": \"generate-code\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <p><em parentName=\"p\">{`Note: Visit the codelab `}<a parentName=\"em\" {...{\n          \"href\": \"../barcode-reader/index.md\"\n        }}>{`Headless Apps with Project Firefly`}</a>{` to learn more about building a headless app for barcode generation.`}</em>{`  `}</p>\n    <p>{`Now that you have it set up in Firefly app, next step is to create a marketing workflow in Campaign Standard which takes care of receiving external signals from the app and sending promotion emails. To do that, go to `}<em parentName=\"p\">{`Marketing Activities > Create > Workflow`}</em>{`. Define the properties of your workflow, and finish the creation.  `}</p>\n    <p>{`Your new workflow should contain 3 components, in correct order:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`External signal`}</li>\n      <li parentName=\"ol\">{`Query user by email`}</li>\n      <li parentName=\"ol\">{`Email delivery`}</li>\n    </ol>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"44.0625%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/bee6d1980915dea365dd1cf1ef6626f4/cb523/acs-workflow.webp 320w\", \"/project-firefly/static/bee6d1980915dea365dd1cf1ef6626f4/797b9/acs-workflow.webp 640w\", \"/project-firefly/static/bee6d1980915dea365dd1cf1ef6626f4/4b075/acs-workflow.webp 1280w\", \"/project-firefly/static/bee6d1980915dea365dd1cf1ef6626f4/de9a1/acs-workflow.webp 1516w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/bee6d1980915dea365dd1cf1ef6626f4/72799/acs-workflow.png 320w\", \"/project-firefly/static/bee6d1980915dea365dd1cf1ef6626f4/6af66/acs-workflow.png 640w\", \"/project-firefly/static/bee6d1980915dea365dd1cf1ef6626f4/21b4d/acs-workflow.png 1280w\", \"/project-firefly/static/bee6d1980915dea365dd1cf1ef6626f4/a8a6f/acs-workflow.png 1516w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/project-firefly/static/bee6d1980915dea365dd1cf1ef6626f4/21b4d/acs-workflow.png\",\n            \"alt\": \"acs-workflow\",\n            \"title\": \"acs-workflow\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <p>{`In the \"External signal\" component, make sure that it accepts `}<inlineCode parentName=\"p\">{`email`}</inlineCode>{` as an input parameter.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"56.56250000000001%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/32a914469e66a6057316d38021c6bf12/cb523/external-signal.webp 320w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/797b9/external-signal.webp 640w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/4b075/external-signal.webp 1280w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/f3ff0/external-signal.webp 1920w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/a662b/external-signal.webp 2560w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/035f8/external-signal.webp 2686w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/32a914469e66a6057316d38021c6bf12/72799/external-signal.png 320w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/6af66/external-signal.png 640w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/21b4d/external-signal.png 1280w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/29114/external-signal.png 1920w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/c2d13/external-signal.png 2560w\", \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/d185f/external-signal.png 2686w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/project-firefly/static/32a914469e66a6057316d38021c6bf12/21b4d/external-signal.png\",\n            \"alt\": \"external-signal\",\n            \"title\": \"external-signal\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <p>{`In the \"Query\" component, make sure that it uses the `}<inlineCode parentName=\"p\">{`email`}</inlineCode>{` param to query user.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"906px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"50%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/2f70619bcc6abe0b76856fee3d1fbdc4/cb523/acs-query.webp 320w\", \"/project-firefly/static/2f70619bcc6abe0b76856fee3d1fbdc4/797b9/acs-query.webp 640w\", \"/project-firefly/static/2f70619bcc6abe0b76856fee3d1fbdc4/dd896/acs-query.webp 906w\"],\n            \"sizes\": \"(max-width: 906px) 100vw, 906px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/2f70619bcc6abe0b76856fee3d1fbdc4/72799/acs-query.png 320w\", \"/project-firefly/static/2f70619bcc6abe0b76856fee3d1fbdc4/6af66/acs-query.png 640w\", \"/project-firefly/static/2f70619bcc6abe0b76856fee3d1fbdc4/6029f/acs-query.png 906w\"],\n            \"sizes\": \"(max-width: 906px) 100vw, 906px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/project-firefly/static/2f70619bcc6abe0b76856fee3d1fbdc4/6029f/acs-query.png\",\n            \"alt\": \"acs-query\",\n            \"title\": \"acs-query\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <p>{`In the \"Email delivery\" component, go to its editor to design the email. In this lab we will use the \"Email Designer\" mode, and leverage the available \"Astro - Coupon\" template.  `}</p>\n    <p>{`Design the email as you prefer. One required component is an image that loads the barcode from the `}<inlineCode parentName=\"p\">{`generate-code`}</inlineCode>{` action.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"59.06250000000001%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/cb523/acs-editor.webp 320w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/797b9/acs-editor.webp 640w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/4b075/acs-editor.webp 1280w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/f3ff0/acs-editor.webp 1920w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/a662b/acs-editor.webp 2560w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/191a4/acs-editor.webp 3354w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/72799/acs-editor.png 320w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/6af66/acs-editor.png 640w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/21b4d/acs-editor.png 1280w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/29114/acs-editor.png 1920w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/c2d13/acs-editor.png 2560w\", \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/e7dd1/acs-editor.png 3354w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/project-firefly/static/9785d7a578abda707b69b23f9cbde81c/21b4d/acs-editor.png\",\n            \"alt\": \"acs-editor\",\n            \"title\": \"acs-editor\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <p>{`Save your Campaign Standard Workflow and start it. It should be now ready to execute upon external signal triggering!  `}</p>\n    <p>{`The last step is to add an action to trigger the Campaign Standard workflow, and a \"Send promo code\" button on the app UI. We use `}<inlineCode parentName=\"p\">{`aio app add action`}</inlineCode>{` again to add the `}<inlineCode parentName=\"p\">{`send-promo`}</inlineCode>{` action.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"48.12500000000001%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/71de605d365790338c1b75ba77eb7590/cb523/action-promo.webp 320w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/797b9/action-promo.webp 640w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/4b075/action-promo.webp 1280w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/f3ff0/action-promo.webp 1920w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/a662b/action-promo.webp 2560w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/7272a/action-promo.webp 2664w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/71de605d365790338c1b75ba77eb7590/72799/action-promo.png 320w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/6af66/action-promo.png 640w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/21b4d/action-promo.png 1280w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/29114/action-promo.png 1920w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/c2d13/action-promo.png 2560w\", \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/26781/action-promo.png 2664w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/project-firefly/static/71de605d365790338c1b75ba77eb7590/21b4d/action-promo.png\",\n            \"alt\": \"action-promo\",\n            \"title\": \"action-promo\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <p>{`In order to trigger the workflow, you need to provide a workflow ID to the triggering API. You can find it on the Campaign Standard UI. In your `}<inlineCode parentName=\"p\">{`.env`}</inlineCode>{` file, add a new variable for it, for example `}<inlineCode parentName=\"p\">{`CAMPAIGN_STANDARD_WORKFLOW_ID=WKFXX`}</inlineCode>{`. This environment variable is then interpreted into a default param of the `}<inlineCode parentName=\"p\">{`send-promo`}</inlineCode>{` action in the `}<inlineCode parentName=\"p\">{`ext.config.yaml`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`send-promo:\n  function: actions/send-promo/index.js\n  web: 'yes'\n  runtime: 'nodejs:14'\n  inputs:\n    LOG_LEVEL: debug\n    tenant: $CAMPAIGN_STANDARD_TENANT\n    apiKey: $SERVICE_API_KEY\n    workflowId: $CAMPAIGN_STANDARD_WORKFLOW_ID\n  annotations:\n    require-adobe-auth: true\n    final: true\n`}</code></pre>\n    <p>{`Then you should update the source code at `}<inlineCode parentName=\"p\">{`actions/send-promo/index.js`}</inlineCode>{` as following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`/**\n * This action triggers Campaign Standard workflow to send promotion email to a specific email address\n */\n\nconst { Core } = require('@adobe/aio-sdk')\nconst { CampaignStandard } = require('@adobe/aio-sdk')\nconst { errorResponse, getBearerToken, stringParameters, checkMissingRequestInputs } = require('../utils')\n\n// main function that will be executed by Adobe I/O Runtime\nasync function main (params) {\n  // create a Logger\n  const logger = Core.Logger('main', { level: params.LOG_LEVEL || 'info' })\n\n  try {\n    // 'info' is the default level if not set\n    logger.info('Calling the main action')\n\n    // log parameters, only if params.LOG_LEVEL === 'debug'\n    logger.debug(stringParameters(params))\n\n    // check for missing request input parameters and headers\n    const requiredParams = ['apiKey', 'tenant', 'workflowId', 'email']\n    const errorMessage = checkMissingRequestInputs(params, requiredParams, ['Authorization'])\n    if (errorMessage) {\n      // return and log client errors\n      return errorResponse(400, errorMessage, logger)\n    }\n\n    // extract the user Bearer token from the input request parameters\n    const token = getBearerToken(params)\n\n    // initialize the sdk\n    const campaignClient = await CampaignStandard.init(params.tenant, params.apiKey, token)\n\n    // get workflow from Campaign Standard\n    const workflow = await campaignClient.getWorkflow(params.workflowId)\n    const wkfHref = workflow.body.activities.activity.signal1.trigger.href\n\n    // trigger the signal activity API\n    const triggerResult = await campaignClient.triggerSignalActivity(wkfHref, { source: 'API', parameters: { email: params.email } })\n    \n    // log the trigger result\n    logger.info(triggerResult)\n\n    const response = {\n      statusCode: 200,\n      body: { success: 'ok' }\n    }\n\n    // log the response status code\n    logger.info(\\`\\${response.statusCode}: successful request\\`)\n    return response\n  } catch (error) {\n    // log any server errors\n    logger.error(error)\n    // return with 500\n    return errorResponse(500, 'server error', logger)\n  }\n}\n\nexports.main = main\n`}</code></pre>\n    <p>{`To update the UI, open `}<inlineCode parentName=\"p\">{`Home.js`}</inlineCode>{` and add method `}<inlineCode parentName=\"p\">{`sendPromo()`}</inlineCode>{` as following.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`async sendPromo (email) {\n  try {\n    const headers = {}\n\n    // set the authorization header and org from the ims props object\n    if (this.props.ims.token && !headers.authorization) {\n      headers.authorization = 'Bearer ' + this.props.ims.token\n    }\n    if (this.props.ims.org && !headers['x-gw-ims-org-id']) {\n      headers['x-gw-ims-org-id'] = this.props.ims.org\n    }\n    const actionResponse = await actionWebInvoke(actions['send-promo'], headers, { email })\n    console.log(\\`Response from send-promo:\\`, actionResponse)\n  } catch (e) {\n    // log and store any error message\n    console.error(e)\n  }\n}\n`}</code></pre>\n    <p>{`Finally let's update the renderred profiles grid view to include the send promo button. As we're using new React Spectrum components for the confirm dialog, make sure that they are imported properly in `}<inlineCode parentName=\"p\">{`Home.js`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`// importing confirm dialog components, along with previously available components\nimport { ActionButton, AlertDialog, DialogTrigger, Flex, Grid, ProgressCircle, Heading, Text, View } from '@adobe/react-spectrum'\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`// in render(), update the Grid component\nrender () {\n  const profiles = this.state.profiles\n  console.log(\\`profiles object:\\`, profiles)\n  return (\n    <View>\n      <Heading level={1}>Customer Profiles</Heading>\n      <Flex UNSAFE_className='profiles'>\n          <ProgressCircle\n            UNSAFE_className='actions-invoke-progress'\n            aria-label='loading'\n            isIndeterminate\n            isHidden={ !this.state.actionInvokeInProgress }/>\n          { !!profiles &&\n            <Grid>\n              {profiles.map((profile, i) => {\n                return <Flex UNSAFE_className='profile' key={ profile['PKey'] }>\n                  <DialogTrigger>\n                    <ActionButton\n                      UNSAFE_className='actions-invoke-button'>\n                      Send promo code\n                    </ActionButton>\n                    <AlertDialog\n                      variant='confirmation'\n                      title='Send promo code'\n                      primaryActionLabel='Confirm'\n                      cancelLabel='Cancel'\n                      onPrimaryAction={ () => this.sendPromo(profile['email']) }>\n                      Do you want to send promo to { profile['email'] }?\n                    </AlertDialog>\n                  </DialogTrigger>\n                  Name: { profile['firstName'] } { profile['lastName'] } - Email: { profile['email'] } - Date of birth: { profile['birthDate'] }\n                </Flex>\n              })}\n            </Grid>\n          }\n          { !profiles &&\n            <Text>No profiles!</Text>\n          }\n        </Flex>\n    </View>\n  )\n}\n`}</code></pre>\n    <p>{`After that, execute `}<inlineCode parentName=\"p\">{`aio app run`}</inlineCode>{` again so that your app is running locally.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"46.25%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/cb523/ui-profiles-button.webp 320w\", \"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/797b9/ui-profiles-button.webp 640w\", \"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/4b075/ui-profiles-button.webp 1280w\", \"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/f3ff0/ui-profiles-button.webp 1920w\", \"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/a393d/ui-profiles-button.webp 2230w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/72799/ui-profiles-button.png 320w\", \"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/6af66/ui-profiles-button.png 640w\", \"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/21b4d/ui-profiles-button.png 1280w\", \"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/29114/ui-profiles-button.png 1920w\", \"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/15171/ui-profiles-button.png 2230w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/project-firefly/static/4ea0970971ef71f3aa509b02610853bd/21b4d/ui-profiles-button.png\",\n            \"alt\": \"ui-profiles-button\",\n            \"title\": \"ui-profiles-button\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <p>{`Try clicking to send promo to a profile which has your own email address. There will be a prompt confirming your command. Check your email inbox that you have received a promo email.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"77.5%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/cb523/email-promo.webp 320w\", \"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/797b9/email-promo.webp 640w\", \"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/4b075/email-promo.webp 1280w\", \"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/f3ff0/email-promo.webp 1920w\", \"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/f083f/email-promo.webp 2434w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/72799/email-promo.png 320w\", \"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/6af66/email-promo.png 640w\", \"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/21b4d/email-promo.png 1280w\", \"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/29114/email-promo.png 1920w\", \"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/41045/email-promo.png 2434w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/project-firefly/static/dd35d8367d5c1bd4bb02105e552ea548/21b4d/email-promo.png\",\n            \"alt\": \"email-promo\",\n            \"title\": \"email-promo\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}