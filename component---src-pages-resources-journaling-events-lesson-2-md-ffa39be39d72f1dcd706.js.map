{"version":3,"file":"component---src-pages-resources-journaling-events-lesson-2-md-ffa39be39d72f1dcd706.js","mappings":"4SAQaA,EAAe,CAAC,EACvBC,EAAc,CAClBD,aAAAA,GAEIE,EAAYC,EAAAA,EACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,gFACA,mEACA,oBACE,eAAIC,WAAW,MAAf,yDACA,eAAIA,WAAW,MAAf,QAA4B,cAAGA,WAAW,KACtC,KAAQ,0CADgB,iBAA5B,iEAGA,eAAIA,WAAW,MAAf,gHAEF,eACE,GAAM,uDADR,wDAGA,qHAAsG,uBAAYA,WAAW,KAAvB,WAAtG,mEAA4N,cAAGA,WAAW,IACtO,KAAQ,yBADgN,UAG5N,ucACA,qTAAsS,cAAGA,WAAW,IAChT,KAAQ,2CAD0R,oBAAtS,oDAGA,eACE,GAAM,2CADR,4CAGA,kCAAmB,cAAGA,WAAW,IAC7B,KAAQ,0CADO,iBAAnB,kGAGA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBADZ,yCAIL,6DACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,yDAIL,kFACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,ydAiBL,4MACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,gRAYL,yCAA0B,cAAGA,WAAW,IACpC,KAAQ,2HADc,UAG1B,eACE,GAAM,yDADR,0DAGA,2NAGH,CAEDJ,EAAWK,gBAAiB,C","sources":["webpack://adobe-developer-app-builder/./src/pages/resources/journaling-events/lesson2.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/app-builder/app-builder/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1>{`Lesson 2: Create the Event Consumer using Journaling API`}</h1>\n    <p>{`In this lesson, we will do the follow steps:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Create an event consumer using App Builder template.`}</li>\n      <li parentName=\"ul\">{`Use `}<a parentName=\"li\" {...{\n          \"href\": \"https://github.com/adobe/aio-lib-state\"\n        }}>{`aio-lib-state`}</a>{` as storage library to store the events from journaling api.`}</li>\n      <li parentName=\"ul\">{`Scheduling cron jobs with alarms to trigger event consumer to pull event from journaling api every x mins.`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"create-an-event-consumer-using-app-builder-template\"\n    }}>{`Create an event consumer using App Builder template`}</h2>\n    <p>{`We will also use App Builder template to create the event consumer, this time we could use the `}<inlineCode parentName=\"p\">{`generic`}</inlineCode>{` template. in this codelab I will create a headless app follow `}<a parentName=\"p\" {...{\n        \"href\": \"../cron-jobs/index.md\"\n      }}>{`here`}</a></p>\n    <p>{`For enterprise developers, Adobe offers journaling to consume events. The Adobe I/O Events Journaling API enables enterprise integrations to consume events according to their own cadence and process them in bulk. Unlike webhooks, no additional registration or other configuration is required; every enterprise integration that is registered for events is automatically enabled for journaling. Journaling data is retained for 7 days.`}</p>\n    <p>{`After you fire event, you should be able to verify your event through journaling UNIQUE API ENDPOINT you get from console by follow below instruction Journaling api you could use Curl command or POSTMAN to call this journaling UNIQUE API ENDPOINT to see your fired event. Or you can use `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/adobe/aio-lib-events\"\n      }}>{`Custom Event SDK`}</a>{` to call Journaling API to retrieve your event.`}</p>\n    <h2 {...{\n      \"id\": \"write-the-data-into-app-builder-storage\"\n    }}>{`Write the data into App Builder storage`}</h2>\n    <p>{`We will use `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/adobe/aio-lib-state\"\n      }}>{`aio-lib-state`}</a>{` to store the event from journaling api. So first weâ€™re going to install the dependency with:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`npm i --save @adobe/aio-lib-state\n`}</code></pre>\n    <p>{`Then we're going to import it as well:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const stateLib = require('@adobe/aio-lib-state');\n`}</code></pre>\n    <p>{`We'll setup the write to storage inside the main function. `}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`async function saveToDb(params, new_events) {\n  const stateCLient = await State.init()\n\n\n  var events = await stateCLient.get(params.db_event_key) \n  if (events === undefined) {\n    events = {latest: new_events[new_events.length - 1], events: new_events}\n  } else {\n    events = events.value\n    events.latest = new_events[new_events.length - 1]\n    events.events.push(new_events)\n  }\n  await stateCLient.put(params.db_event_key, events, { ttl: -1 })\n}\n`}</code></pre>\n    <p>{`also we will write down the event postion to ensure that if this action fails, the next invocation will retrieve from the same index instead of the new one. Thus no events are lost.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`async function getLatestEventPosition(params) {\n  const stateCLient = await State.init()\n  const events = await stateCLient.get(params.db_event_key)\n  if (events === undefined) {\n    return undefined\n  } else {\n    return events.value.latest.position\n  }\n}\n`}</code></pre>\n    <p>{`the source code is `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/AdobeDocs/adobeio-samples-journaling-events/blob/main/event-consumer/actions/event_consumer/index.js\"\n      }}>{`here`}</a></p>\n    <h2 {...{\n      \"id\": \"scheduling-cron-jobs-to-automate-the-consuming-events\"\n    }}>{`Scheduling cron jobs to automate the consuming events`}</h2>\n    <p>{`Same steps as in lesson 2 to scheduling cron jobs to make sure the consumer pulling events from journaling api every x mins. Now we can deploy this event consumer app in another runtime namespace. `}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}